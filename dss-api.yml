swagger: '2.0'
info:
  title: HCA DCP DSS API
  description: Human Cell Atlas Data Coordination Platform Data Storage System API
  version: "0.0.1"
host: dss-api.czi.technology
schemes:
  - https
basePath: /v1
produces:
  - application/json
paths:
  /files:
    get:
      summary: Query files
      description: |
        Returns a list of files matching given criteria.
      responses:
        200:
          description: OK
          schema:
            type: object
            properties:
              files:
                type: array
                items:
                  $ref: "#/definitions/File"
            required:
              - files
    post:
      summary: Create a file
      description: |
        TODO
      responses:
        200:
          description: OK
  /files/{uuid}:
    get:
      parameters:
        - name: replica
          in: query
          description: Replica to fetch from.
          required: true
          type: string
        - name: uuid
          in: path
          description: File unique ID.
          required: true
          type: string
      responses:
        302:
          description: Redirect to a file location
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
  /bundles:
    get:
      summary: Query bundles
      description: |
        Returns a list of bundles matching given criteria.
      responses:
        200:
          description: OK
          schema:
            type: object
            properties:
              bundles:
                type: array
                items:
                  $ref: "#/definitions/Bundle"
            required:
              - bundles
    post:
      summary: Create a bundle
      description: |
        TODO
      responses:
        200:
          description: OK
  /bundles/{uuid}:
    get:
      parameters:
        - name: replica
          in: query
          description: Replica to fetch from.
          required: true
          type: string
        - name: uuid
          in: path
          description: Bundle unique ID.
          required: true
          type: string
      responses:
        200:
          description: OK
          schema:
            type: object
            properties:
              files:
                type: array
                items:
                  $ref: "#/definitions/File"
            required:
              - files
        default:
          description: Unexpected error
          schema:
            $ref: '#/definitions/Error'
definitions:
  File:
    type: object
    properties:
      uuid:
        type: string
        description: File unique ID
      name:
        type: string
        description: Filename (unique within a bundle)
      versions:
        type: array
        description: List of versions
        items:
          type: string
    required:
      - uuid
      - name
      - versions
  blob_common_metadata:
    type: object
    description: Common fields between the files list of a bundle and the metadata tracking an unique file.
    properties:
      uuid:
        type: string
        description: File unique ID
      timestamp:
        type: integer
        format: int64
        description: Timestamp of file creation measured in milliseconds since epoch
      crc32c:
        type: string
        description: CRC-32C of the file contents in hex
      md5:
        type: string
        description: MD5 of the file contents in hex
      sha1:
        type: string
        description: SHA-1 of the file contents in hex
      sha256:
        type: string
        description: SHA-256 of the file contents in hex
    required:
      - uuid
      - timestamp
      - crc32c
      - md5
      - sha1
      - sha256
  file_version:
    type: object
    description: Object describing a single file in the files list of a bundle.
    allOf:
      - $ref: '#/definitions/blob_common_metadata'
      - type: object
        properties:
          name:
            type: string
            description: Filename (unique within a bundle)
          content-type:
            type: string
            description: Content-type of the file.
        required:
          - name
          - content-type
  file_metadata:
    type: object
    description: Object describing a single file in the files list of a bundle.
    allOf:
      - $ref: '#/definitions/blob_common_metadata'
      - type: object
        properties:
          version:
            type: string
            description: Version of the file metadata object.
          bundle_uuid:
            type: string
            description: Bundle ID that contains this file.
          writer_uid:
            type: integer
            format: int64
            description: User ID who wrote this file.
        required:
          - version
          - bundle_uuid
          - writer_uid
  Bundle:
    type: object
    properties:
      uuid:
        type: string
        description: Bundle unique ID
      versions:
        type: array
        items:
          type: integer
          format: int64
          description: Timestamp of bundle creation measured in milliseconds since epoch
    required:
      - uuid
      - versions
  Error:
    type: object
    properties:
      code:
        type: integer
        format: int32
      message:
        type: string
      fields:
        type: string
  FilesGetResponse:
    type: object
    properties:
      files:
        type: string

